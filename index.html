<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef VZLA - Inteligencia Culinaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3D7A55;
            --dark: #14201D;
            --bg-light: #DDF6F1;
            --action: #66CFA0;
            --accent-orange: #F97316;
            --accent-blue: #3B82F6;
            --highlight: #fef08a;
        }

        [x-cloak] { display: none !important; }
        
        body { 
            background-color: var(--bg-light); 
            color: var(--dark);
            font-family: 'Inter', sans-serif;
        }

        /* Utilidades de Color Personalizadas */
        .bg-custom-primary { background-color: var(--primary); }
        .bg-custom-orange { background-color: var(--accent-orange); }
        .bg-custom-blue { background-color: var(--accent-blue); }
        .text-custom-primary { color: var(--primary); }
        .text-custom-orange { color: var(--accent-orange); }
        .text-custom-blue { color: var(--accent-blue); }
        .border-custom-primary { border-color: var(--primary); }

        /* Animaciones y Hover */
        .recipe-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .recipe-card:hover { transform: translateY(-8px); box-shadow: 0 20px 25px -5px rgba(20, 32, 29, 0.1); }
        
        .sidebar-drawer { transition: transform 0.3s ease-in-out; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-light); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden" x-data="app()">

    <nav class="bg-white border-b h-16 shrink-0 flex items-center justify-between px-4 md:px-8 shadow-sm z-40">
        <div class="flex items-center gap-4">
            <button @click="sidebarOpen = true" class="lg:hidden p-2 text-custom-primary hover:bg-slate-100 rounded-lg transition">
                <i class="fas fa-bars-staggered text-xl"></i>
            </button>
            <div class="flex items-center gap-2">
                <div class="bg-custom-primary text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-200">
                    <i class="fas fa-hat-chef text-lg"></i>
                </div>
                <h1 class="font-black text-xl hidden sm:block" style="color: var(--dark)">Chef<span class="text-custom-primary">VZLA</span></h1>
            </div>
        </div>
        
        <div class="flex items-center bg-slate-50 rounded-2xl p-1.5 border border-slate-200">
            <div class="flex items-center px-3 border-r border-slate-200 gap-2">
                <i class="fas fa-user-group text-[10px] text-custom-primary"></i>
                <input type="number" x-model.number="config.adultos" class="w-8 bg-transparent text-center font-bold text-sm focus:outline-none">
            </div>
            <div class="flex items-center px-3 gap-2">
                <i class="fas fa-baby text-[10px] text-custom-orange"></i>
                <input type="number" x-model.number="config.ninos" class="w-8 bg-transparent text-center font-bold text-sm focus:outline-none">
            </div>
        </div>
    </nav>

    <div class="flex-1 flex overflow-hidden relative">
        
        <aside :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'" 
               class="sidebar-drawer fixed lg:relative lg:flex w-72 h-full bg-white border-r z-50 flex flex-col shadow-2xl lg:shadow-none">
            
            <div class="p-6 border-b flex justify-between items-center" style="background-color: #fafdfc">
                <h2 class="font-bold flex items-center gap-2" style="color: var(--dark)">
                    <i class="fas fa-refrigerator text-custom-primary"></i> Mi Despensa
                </h2>
                <button @click="sidebarOpen = false" class="lg:hidden text-slate-400"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="p-4 border-b">
                <button @click="abrirModalAdd()" class="w-full bg-custom-primary text-white py-3 rounded-2xl text-xs font-black hover:bg-opacity-90 transition-all flex items-center justify-center gap-2 shadow-md">
                    <i class="fas fa-plus-circle"></i> AGREGAR INGREDIENTE
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-2">
                <template x-for="(item, index) in inventario" :key="index">
                    <div class="flex justify-between items-center p-4 rounded-2xl border border-slate-100 bg-white hover:border-custom-primary group transition-all">
                        <div>
                            <p class="font-bold text-sm" style="color: var(--dark)" x-text="item.nombre"></p>
                            <p class="text-[10px] font-black text-custom-blue" x-text="item.cantidad + ' ' + item.unidad"></p>
                        </div>
                        <button @click="eliminarItem(index)" class="text-slate-200 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </template>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto p-4 md:p-8">
            
            <div class="max-w-4xl mx-auto mb-12">
                <div class="relative group">
                    <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-custom-primary transition"></i>
                    <input type="text" x-model="busqueda" placeholder="Â¿QuÃ© tienes en mente? (Pollo, Lentejas, Pasta...)" 
                           class="w-full pl-14 pr-6 py-5 rounded-[2rem] bg-white shadow-xl border-0 focus:ring-4 focus:ring-emerald-100 transition text-lg outline-none">
                </div>
            </div>

            <div class="max-w-6xl mx-auto">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-2xl font-black flex items-center gap-3" style="color: var(--dark)">
                            <span class="w-2 h-8 bg-custom-orange rounded-full"></span>
                            <span x-text="busqueda === '' ? 'Sugerencias para Hoy' : 'Resultados de BÃºsqueda'"></span>
                        </h2>
                    </div>
                    <button @click="buscarEnInternet()" 
                            class="px-6 py-3 rounded-2xl bg-custom-blue text-white font-black text-xs shadow-lg shadow-blue-100 hover:scale-105 transition-all flex items-center gap-2">
                        <i class="fas fa-cloud-arrow-down" :class="buscando ? 'fa-spin' : ''"></i>
                        <span x-text="buscando ? 'BUSCANDO...' : 'BUSCAR EN LA NUBE'"></span>
                    </button>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-8">
                    <template x-for="receta in recetasAMostrar" :key="receta.nombre">
                        <div @click="abrirReceta(receta)" 
                             class="recipe-card bg-white rounded-[2.5rem] border border-slate-100 overflow-hidden cursor-pointer flex flex-col h-full">
                            
                            <div class="h-32 bg-slate-50 relative p-6">
                                <span class="bg-white/90 backdrop-blur-md text-[9px] font-black px-3 py-1.5 rounded-full text-custom-primary shadow-sm border border-emerald-50" x-text="receta.tipo"></span>
                                <div class="absolute top-6 right-6">
                                    <div :class="verificarStock(receta) ? 'bg-green-500' : 'bg-custom-orange'" 
                                         class="w-3 h-3 rounded-full border-2 border-white shadow-sm"></div>
                                </div>
                            </div>

                            <div class="p-6 flex-1 flex flex-col">
                                <h3 class="font-black text-slate-800 text-md mb-4 line-clamp-2 leading-snug" x-text="receta.nombre"></h3>
                                <div class="mt-auto pt-4 border-t border-slate-50 flex justify-between items-center">
                                    <div class="flex items-center gap-1 text-[10px] font-bold text-slate-400">
                                        <i class="far fa-clock"></i> <span x-text="receta.tiempo || '25m'"></span>
                                    </div>
                                    <span class="text-[10px] font-black" :class="verificarStock(receta) ? 'text-green-600' : 'text-custom-orange'" 
                                          x-text="verificarStock(receta) ? 'LISTO' : 'FALTA STOCK'"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <div x-show="recetasAMostrar.length === 0" class="text-center py-24 bg-white/50 rounded-[3rem] border-4 border-dashed border-white">
                    <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl text-4xl">ðŸ¥˜</div>
                    <h3 class="font-black text-slate-700 text-xl mb-2">Â¡Ups! No hay nada localmente</h3>
                    <p class="text-slate-400 text-sm mb-8 max-w-xs mx-auto">Prueba pulsando el botÃ³n azul de <b>"Buscar en la Nube"</b> para encontrar platos con <span x-text="busqueda" class="text-custom-blue"></span>.</p>
                </div>
            </div>
        </main>
    </div>

    <div x-show="modalOpen" x-cloak class="fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div x-show="modalOpen" x-transition.opacity @click="cerrarReceta()" class="absolute inset-0 bg-[#14201Dcc] backdrop-blur-md"></div>
        
        <div x-show="modalOpen" x-transition.scale.95 class="bg-white w-full max-w-6xl max-h-[92vh] rounded-[3rem] shadow-2xl overflow-hidden flex flex-col md:flex-row relative">
            <button @click="cerrarReceta()" class="absolute top-8 right-8 z-10 bg-slate-100 hover:bg-red-50 hover:text-red-500 w-12 h-12 rounded-full flex items-center justify-center transition-all">
                <i class="fas fa-times text-lg"></i>
            </button>

            <template x-if="recetaActiva">
                <div class="contents">
                    <div class="md:w-96 p-10 shrink-0 bg-slate-50 flex flex-col overflow-y-auto">
                        <span class="text-[10px] font-black text-custom-blue uppercase tracking-widest mb-4" x-text="recetaActiva.tipo"></span>
                        <h2 class="text-4xl font-black text-slate-800 leading-tight mb-6" x-text="recetaActiva.nombre"></h2>
                        <p class="text-sm text-slate-500 mb-10 leading-relaxed" x-text="recetaActiva.desc"></p>

                        <a :href="'https://www.youtube.com/results?search_query=receta+venezolana+' + recetaActiva.nombre" target="_blank" 
                           class="flex items-center gap-4 p-5 bg-white border border-slate-100 rounded-[1.5rem] hover:border-custom-blue transition group mb-10">
                            <div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center text-red-600 group-hover:scale-110 transition">
                                <i class="fab fa-youtube text-2xl"></i>
                            </div>
                            <div>
                                <p class="text-[10px] font-black text-slate-400">VIDEO TUTORIAL</p>
                                <p class="text-xs font-bold text-slate-700">Ver en YouTube</p>
                            </div>
                        </a>

                        <div class="mt-auto">
                            <button @click="cocinar()" :disabled="!verificarStock(recetaActiva)"
                                    class="w-full py-5 rounded-[1.5rem] font-black text-white shadow-xl transition-all active:scale-95 disabled:bg-slate-200 bg-custom-dark hover:bg-custom-primary">
                                <i class="fas fa-fire-burner mr-2"></i> EMPEZAR A COCINAR
                            </button>
                        </div>
                    </div>

                    <div class="flex-1 p-10 overflow-y-auto bg-white">
                        <div class="grid lg:grid-cols-2 gap-12">
                            <div>
                                <h3 class="font-black text-xl mb-8 flex items-center gap-3">
                                    <i class="fas fa-basket-shopping text-custom-orange"></i> Ingredientes
                                </h3>
                                <ul class="space-y-4">
                                    <template x-for="(cantBase, ing) in recetaActiva.ingredientes">
                                        <li class="flex justify-between items-center p-4 rounded-2xl border border-slate-50 hover:bg-slate-50 transition">
                                            <div class="flex items-center gap-4">
                                                <div class="w-2 h-2 rounded-full" :class="tieneIngrediente(ing, calcularCantidad(cantBase)) ? 'bg-green-500' : 'bg-custom-orange'"></div>
                                                <span class="text-sm font-bold" :class="tieneIngrediente(ing, calcularCantidad(cantBase)) ? 'text-slate-700' : 'text-custom-orange'" x-text="ing"></span>
                                            </div>
                                            <span class="text-[10px] font-black text-slate-400 bg-slate-100 px-3 py-1.5 rounded-xl" x-text="calcularCantidad(cantBase) + ' ' + obtenerUnidad(ing)"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                            <div>
                                <h3 class="font-black text-xl mb-8 flex items-center gap-3">
                                    <i class="fas fa-list-check text-custom-primary"></i> PreparaciÃ³n Paso a Paso
                                </h3>
                                <div class="space-y-8 relative">
                                    <template x-for="(paso, idx) in recetaActiva.preparacion">
                                        <div class="flex gap-6">
                                            <div class="w-8 h-8 rounded-xl bg-custom-primary/10 text-custom-primary flex items-center justify-center font-black text-sm shrink-0" x-text="idx + 1"></div>
                                            <p class="text-sm text-slate-600 leading-loose" x-text="paso"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <div x-show="addModalOpen" x-cloak class="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] shadow-2xl w-full max-w-md p-10 relative">
            <h3 class="text-2xl font-black mb-8 text-slate-800 flex items-center gap-3">
                <i class="fas fa-cart-plus text-custom-primary"></i> Nuevo Alimento
            </h3>
            
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Nombre del Ingrediente</label>
                    <input type="text" x-model="nuevoItem.nombre" placeholder="Ej. Pollo, Lentejas..." 
                           class="w-full p-4 border-2 border-slate-50 rounded-2xl bg-slate-50 outline-none focus:border-custom-primary focus:bg-white transition-all">
                </div>
                
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Cantidad</label>
                        <input type="number" x-model.number="nuevoItem.cantidad" placeholder="0" 
                               class="w-full p-4 border-2 border-slate-50 rounded-2xl bg-slate-50 outline-none focus:border-custom-primary focus:bg-white transition-all">
                    </div>
                    <div class="w-32">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Unidad</label>
                        <select x-model="nuevoItem.unidad" class="w-full p-4 border-2 border-slate-50 rounded-2xl bg-slate-50 font-bold outline-none focus:border-custom-primary transition-all">
                            <option value="g">Gramos (g)</option>
                            <option value="und">Unidades</option>
                            <option value="ml">Mililitros (ml)</option>
                        </select>
                    </div>
                </div>

                <div class="pt-4">
                    <button @click="agregarItem()" 
                            class="w-full bg-custom-primary text-white font-black py-5 rounded-2xl shadow-xl shadow-emerald-100 hover:scale-[1.02] transition-all active:scale-95">
                        GUARDAR EN NEVERA
                    </button>
                    <button @click="addModalOpen = false" class="w-full text-slate-400 font-bold py-4 text-xs mt-2">CANCELAR</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                sidebarOpen: false,
                buscando: false,
                modalOpen: false,
                addModalOpen: false,
                busqueda: '',
                recetaActiva: null,
                config: { adultos: 2, ninos: 1 },
                
                // InicializaciÃ³n sÃ³lida de nuevoItem
                nuevoItem: { nombre: '', cantidad: null, unidad: 'g' },
                
                inventario: JSON.parse(localStorage.getItem('chefvzla_stock')) || [
                    { nombre: 'Harina de MaÃ­z', cantidad: 1000, unidad: 'g' },
                    { nombre: 'Huevo', cantidad: 12, unidad: 'und' }
                ],
                
                recetario: JSON.parse(localStorage.getItem('chefvzla_recipes')) || [
                    { 
                        nombre: 'Arepas con Huevo y Mantequilla', 
                        tipo: 'Desayuno', 
                        desc: 'Un clÃ¡sico que nunca falla para iniciar el dÃ­a con energÃ­a.',
                        ingredientes: { 'Harina de MaÃ­z': 100, 'Huevo': 1 },
                        preparacion: [
                            'Mezcla la harina con agua y una pizca de sal hasta que no se pegue a las manos.',
                            'Forma bolas circulares y aplÃ¡nalas hasta obtener discos de 2cm.',
                            'Cocina en un budare o sartÃ©n caliente 5 minutos por cada lado.',
                            'Rellena con un huevo frito y un toque de mantequilla.'
                        ]
                    }
                ],

                // BASE DE DATOS EXTERNA (NUBE)
                nubeRecetas: [
                    { 
                        nombre: 'Pollo Sudado con Papas', 
                        tipo: 'Almuerzo', 
                        desc: 'Pollo tierno cocinado en su propio jugo con un toque criollo.',
                        ingredientes: { 'Pollo': 150, 'Papa': 1, 'Cebolla': 0.2 },
                        preparacion: [
                            'Sella las piezas de pollo en una olla con poco aceite hasta que doren.',
                            'Agrega cebolla y papas cortadas en trozos medianos.',
                            'Vierte media taza de agua, tapa la olla y cocina a fuego bajo por 25 minutos.',
                            'Sirve cuando el pollo estÃ© tierno y la salsa haya espesado.'
                        ]
                    },
                    { 
                        nombre: 'Lentejas con Arroz Blanco', 
                        tipo: 'Almuerzo', 
                        desc: 'Plato nutritivo, econÃ³mico y muy reconfortante para la familia.',
                        ingredientes: { 'Lentejas': 100, 'Arroz': 100, 'Cebolla': 0.1 },
                        preparacion: [
                            'Cocina las lentejas en abundante agua hasta que ablanden.',
                            'En una sartÃ©n, haz un sofrito con cebolla y ajo, agrÃ©galo a las lentejas.',
                            'Prepara el arroz blanco de forma tradicional (2 tazas de agua por 1 de arroz).',
                            'Sirve las lentejas sobre el arroz bien caliente.'
                        ]
                    },
                    { 
                        nombre: 'Pescado al Horno con LimÃ³n', 
                        tipo: 'Cena Saludable', 
                        desc: 'Ligero y delicioso, ideal para una cena nutritiva.',
                        ingredientes: { 'Pescado': 200, 'LimÃ³n': 0.5, 'Cebolla': 0.2 },
                        preparacion: [
                            'Limpia el pescado y colÃ³calo sobre una bandeja para horno.',
                            'BaÃ±a con jugo de limÃ³n y coloca rodajas de cebolla por encima.',
                            'Hornea a 180Â°C durante 15-20 minutos segÃºn el grosor del filete.',
                            'AcompaÃ±a con una ensalada fresca o arroz.'
                        ]
                    }
                ],

                init() {
                    this.$watch('inventario', val => localStorage.setItem('chefvzla_stock', JSON.stringify(val)));
                    this.$watch('recetario', val => localStorage.setItem('chefvzla_recipes', JSON.stringify(val)));
                },

                abrirModalAdd() {
                    this.nuevoItem = { nombre: '', cantidad: null, unidad: 'g' };
                    this.addModalOpen = true;
                },

                agregarItem() {
                    // ValidaciÃ³n de datos
                    if(!this.nuevoItem || !this.nuevoItem.nombre || !this.nuevoItem.cantidad) {
                        alert("Por favor rellena el nombre y la cantidad.");
                        return;
                    }

                    const nombreNormalizado = this.nuevoItem.nombre.trim();
                    const index = this.inventario.findIndex(i => i.nombre.toLowerCase() === nombreNormalizado.toLowerCase());

                    if(index !== -1) {
                        this.inventario[index].cantidad += parseFloat(this.nuevoItem.cantidad);
                    } else {
                        this.inventario.push({
                            nombre: nombreNormalizado,
                            cantidad: parseFloat(this.nuevoItem.cantidad),
                            unidad: this.nuevoItem.unidad
                        });
                    }

                    // Reset y cierre
                    this.nuevoItem = { nombre: '', cantidad: null, unidad: 'g' };
                    this.addModalOpen = false;
                },

                get recetasAMostrar() {
                    const t = this.busqueda.toLowerCase();
                    if (t === '') {
                        return this.recetario.sort((a,b) => this.verificarStock(b) - this.verificarStock(a)).slice(0, 8);
                    }
                    return this.recetario.filter(r => 
                        r.nombre.toLowerCase().includes(t) || 
                        Object.keys(r.ingredientes).some(i => i.toLowerCase().includes(t))
                    );
                },

                async buscarEnInternet() {
                    this.buscando = true;
                    await new Promise(r => setTimeout(r, 1500));
                    
                    const t = this.busqueda.toLowerCase();
                    let encontradas = 0;

                    const fuente = t === '' ? this.nubeRecetas : this.nubeRecetas.filter(r => 
                        r.nombre.toLowerCase().includes(t) || 
                        Object.keys(r.ingredientes).some(i => i.toLowerCase().includes(t))
                    );

                    fuente.forEach(rn => {
                        if (!this.recetario.find(r => r.nombre === rn.nombre)) {
                            this.recetario.push(rn);
                            encontradas++;
                        }
                    });

                    this.buscando = false;
                    if(encontradas > 0) alert(`Â¡Ã‰xito! He encontrado ${encontradas} recetas nuevas en la nube.`);
                    else alert("No hay nuevas recetas para esta bÃºsqueda.");
                },

                abrirReceta(r) { this.recetaActiva = r; this.modalOpen = true; },
                cerrarReceta() { this.modalOpen = false; this.recetaActiva = null; },
                calcularCantidad(base) { return Math.ceil(base * (this.config.adultos + (this.config.ninos * 0.5))); },
                obtenerUnidad(ing) {
                    const it = this.inventario.find(i => i.nombre.toLowerCase().includes(ing.toLowerCase()) || ing.toLowerCase().includes(i.nombre.toLowerCase()));
                    return it ? it.unidad : 'und.';
                },
                tieneIngrediente(nom, cant) {
                    const it = this.inventario.find(i => i.nombre.toLowerCase().includes(nom.toLowerCase()) || nom.toLowerCase().includes(i.nombre.toLowerCase()));
                    return it && it.cantidad >= cant;
                },
                verificarStock(receta) {
                    return Object.entries(receta.ingredientes).every(([ing, cant]) => this.tieneIngrediente(ing, this.calcularCantidad(cant)));
                },
                eliminarItem(i) { this.inventario.splice(i, 1); },
                cocinar() {
                    if(!confirm("Â¿Descontar estos ingredientes de tu nevera?")) return;
                    Object.entries(this.recetaActiva.ingredientes).forEach(([ing, cant]) => {
                        const it = this.inventario.find(i => i.nombre.toLowerCase().includes(ing.toLowerCase()) || ing.toLowerCase().includes(i.nombre.toLowerCase()));
                        if(it) it.cantidad = Math.max(0, it.cantidad - this.calcularCantidad(cant));
                    });
                    this.cerrarReceta();
                }
            }
        }
    </script>
</body>
</html>
