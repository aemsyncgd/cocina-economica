<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef VZLA - Pro Kitchen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3D7A55;
            --dark: #14201D;
            --bg-light: #DDF6F1;
            --action: #66CFA0;
            --accent-orange: #F97316;
            --accent-blue: #3B82F6;
            --highlight: #fef08a;
        }
        [x-cloak] { display: none !important; }
        body { background-color: var(--bg-light); color: var(--dark); font-family: 'Inter', sans-serif; }
        
        /* Estilos de la barra lateral m√≥vil */
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .bg-custom-primary { background-color: var(--primary); }
        .text-custom-orange { color: var(--accent-orange); }
        .text-custom-blue { color: var(--accent-blue); }
        
        .recipe-card:hover { transform: translateY(-4px); box-shadow: 0 12px 20px -5px rgba(20, 32, 29, 0.15); }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden" x-data="app()">

    <nav class="bg-white border-b h-16 shrink-0 flex items-center justify-between px-4 md:px-6 shadow-sm z-40">
        <div class="flex items-center gap-3">
            <button @click="sidebarOpen = true" class="lg:hidden p-2 text-custom-primary">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <div class="bg-custom-primary text-white w-9 h-9 rounded-lg flex items-center justify-center shadow-md">
                <i class="fas fa-utensils"></i>
            </div>
            <h1 class="font-black text-lg hidden sm:block">Chef<span class="text-custom-primary">VZLA</span></h1>
        </div>
        
        <div class="flex items-center bg-slate-50 rounded-full px-3 py-1 border border-slate-200 scale-90 sm:scale-100">
            <div class="flex items-center gap-2 border-r pr-3">
                <i class="fas fa-user-tie text-[10px] text-slate-400"></i>
                <input type="number" x-model.number="config.adultos" class="w-6 bg-transparent font-bold text-xs focus:outline-none">
            </div>
            <div class="flex items-center gap-2 pl-3">
                <i class="fas fa-child text-[10px] text-slate-400"></i>
                <input type="number" x-model.number="config.ninos" class="w-6 bg-transparent font-bold text-xs focus:outline-none">
            </div>
        </div>
    </nav>

    <div class="flex-1 flex overflow-hidden relative">
        
        <aside :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'" 
               class="fixed lg:relative lg:flex w-72 h-full bg-white border-r z-50 sidebar-transition flex flex-col shadow-2xl lg:shadow-none">
            
            <div class="p-6 border-b flex justify-between items-center bg-slate-50/50">
                <h2 class="font-bold flex items-center gap-2"><i class="fas fa-kitchen-set text-custom-primary"></i> Mi Despensa</h2>
                <button @click="sidebarOpen = false" class="lg:hidden text-slate-400"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="p-4 border-b">
                <button @click="addModalOpen = true" class="w-full bg-custom-primary text-white py-2 rounded-xl text-sm font-bold hover:bg-opacity-90 transition flex items-center justify-center gap-2">
                    <i class="fas fa-plus-circle"></i> Agregar Alimento
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-2">
                <template x-for="(item, index) in inventario" :key="index">
                    <div class="flex justify-between items-center p-3 rounded-xl border border-slate-100 bg-white hover:border-custom-primary group transition">
                        <div>
                            <p class="font-bold text-sm" x-text="item.nombre"></p>
                            <p class="text-[10px] font-mono text-custom-blue" x-text="item.cantidad + ' ' + item.unidad"></p>
                        </div>
                        <button @click="eliminarItem(index)" class="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition"><i class="fas fa-trash"></i></button>
                    </div>
                </template>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto p-4 md:p-8 relative">
            
            <div class="max-w-4xl mx-auto mb-8">
                <div class="relative">
                    <input type="text" x-model="busqueda" placeholder="¬øQu√© quieres cocinar? (Ej. Pollo, Lentejas...)" 
                           class="w-full pl-12 pr-4 py-4 rounded-2xl bg-white shadow-lg border-0 focus:ring-4 focus:ring-custom-primary/20 text-md outline-none transition">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-300"></i>
                </div>
            </div>

            <div class="max-w-6xl mx-auto">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h2 class="text-xl font-black flex items-center gap-2">
                        <span class="w-2 h-8 bg-custom-orange rounded-full"></span>
                        <span x-text="busqueda === '' ? 'Sugerencias para Ti' : 'Resultados de B√∫squeda'"></span>
                    </h2>
                    <button @click="buscarEnInternet()" 
                            class="w-full sm:w-auto px-6 py-2.5 rounded-xl bg-custom-blue text-white font-bold text-xs shadow-md shadow-blue-200 hover:scale-105 transition flex items-center justify-center gap-2">
                        <i class="fas fa-cloud-arrow-down" :class="buscando ? 'fa-spin' : ''"></i>
                        <span x-text="buscando ? 'Conectando...' : 'Buscar en la Nube'"></span>
                    </button>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <template x-for="receta in recetasAMostrar" :key="receta.nombre">
                        <div @click="abrirReceta(receta)" 
                             class="recipe-card bg-white rounded-3xl border border-slate-100 overflow-hidden cursor-pointer flex flex-col h-full transition-all">
                            
                            <div class="h-24 bg-gradient-to-br from-slate-100 to-slate-200 relative p-4">
                                <span class="bg-white/80 backdrop-blur-sm text-[9px] font-black px-2 py-1 rounded-lg text-custom-primary uppercase shadow-sm" x-text="receta.tipo"></span>
                                <div class="absolute top-4 right-4">
                                    <i class="fas fa-circle text-[10px]" :class="verificarStock(receta) ? 'text-green-500' : 'text-custom-orange'"></i>
                                </div>
                            </div>

                            <div class="p-5 flex-1 flex flex-col">
                                <h3 class="font-bold text-slate-800 text-sm mb-3 line-clamp-2" x-text="receta.nombre"></h3>
                                <div class="mt-auto pt-3 border-t flex justify-between items-center">
                                    <span class="text-[10px] font-bold text-slate-400 uppercase"><i class="far fa-clock mr-1"></i> <span x-text="receta.tiempo || '30m'"></span></span>
                                    <span class="text-[10px] font-black" :class="verificarStock(receta) ? 'text-green-600' : 'text-custom-orange'" x-text="verificarStock(receta) ? 'LISTO' : 'FALTA STOCK'"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <div x-show="recetasAMostrar.length === 0" class="text-center py-20 bg-white/40 rounded-3xl border-2 border-dashed border-slate-300">
                    <div class="text-5xl mb-4">üîç</div>
                    <h3 class="font-bold text-slate-600">No encontramos nada localmente</h3>
                    <p class="text-slate-400 text-sm mb-6 px-4">Intenta con el bot√≥n "Buscar en la Nube" para encontrar recetas de <span x-text="busqueda"></span>.</p>
                </div>
            </div>
        </main>
    </div>

    <div x-show="modalOpen" x-cloak class="fixed inset-0 z-[60] flex items-center justify-center p-2 sm:p-6">
        <div x-show="modalOpen" x-transition.opacity @click="cerrarReceta()" class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
        
        <div x-show="modalOpen" x-transition.scale.95 class="bg-white w-full max-w-5xl max-h-[95vh] rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col md:flex-row relative">
            <button @click="cerrarReceta()" class="absolute top-6 right-6 z-10 bg-slate-100 w-10 h-10 rounded-full flex items-center justify-center hover:bg-red-50 hover:text-red-500 transition">
                <i class="fas fa-times"></i>
            </button>

            <template x-if="recetaActiva">
                <div class="contents">
                    <div class="md:w-80 p-8 shrink-0 bg-slate-50 flex flex-col">
                        <span class="text-[10px] font-black text-custom-blue uppercase tracking-[0.2em] mb-3" x-text="recetaActiva.tipo"></span>
                        <h2 class="text-3xl font-black text-slate-800 leading-tight mb-4" x-text="recetaActiva.nombre"></h2>
                        <p class="text-sm text-slate-500 mb-8" x-text="recetaActiva.desc"></p>

                        <a :href="'https://www.youtube.com/results?search_query=receta+facil+' + recetaActiva.nombre" target="_blank" 
                           class="flex items-center gap-3 p-4 bg-white border rounded-2xl hover:border-custom-blue transition group">
                            <i class="fab fa-youtube text-2xl text-red-600"></i>
                            <span class="text-[10px] font-bold text-slate-600">VER PASO A PASO EN VIDEO</span>
                        </a>

                        <div class="mt-auto pt-8">
                            <button @click="cocinar()" :disabled="!verificarStock(recetaActiva)"
                                    class="w-full py-4 rounded-2xl font-black text-white shadow-lg transition active:scale-95 disabled:bg-slate-200 bg-custom-primary hover:bg-opacity-90">
                                <i class="fas fa-fire-burner mr-2"></i> EMPEZAR A COCINAR
                            </button>
                        </div>
                    </div>

                    <div class="flex-1 p-8 overflow-y-auto bg-white">
                        <div class="grid lg:grid-cols-2 gap-12">
                            <div>
                                <h3 class="font-black text-lg mb-6 flex items-center gap-3">
                                    <span class="w-1.5 h-6 bg-custom-blue rounded-full"></span> Ingredientes
                                </h3>
                                <ul class="space-y-3">
                                    <template x-for="(cantBase, ing) in recetaActiva.ingredientes">
                                        <li class="flex justify-between items-center p-3 rounded-2xl border border-slate-50 hover:bg-slate-50 transition">
                                            <div class="flex items-center gap-3">
                                                <i class="fas fa-circle text-[6px]" :class="tieneIngrediente(ing, calcularCantidad(cantBase)) ? 'text-green-500' : 'text-custom-orange'"></i>
                                                <span class="text-sm font-medium" :class="tieneIngrediente(ing, calcularCantidad(cantBase)) ? 'text-slate-700' : 'text-custom-orange font-bold'" x-text="ing"></span>
                                            </div>
                                            <span class="text-[10px] font-black text-slate-400 bg-slate-100 px-2 py-1 rounded-md" x-text="calcularCantidad(cantBase) + ' ' + obtenerUnidad(ing)"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                            <div>
                                <h3 class="font-black text-lg mb-6 flex items-center gap-3">
                                    <span class="w-1.5 h-6 bg-custom-orange rounded-full"></span> Preparaci√≥n
                                </h3>
                                <div class="space-y-6">
                                    <template x-for="(paso, idx) in recetaActiva.preparacion">
                                        <div class="flex gap-4">
                                            <span class="w-6 h-6 rounded-lg bg-custom-primary/10 text-custom-primary flex items-center justify-center font-bold text-xs shrink-0" x-text="idx + 1"></span>
                                            <p class="text-sm text-slate-600 leading-relaxed" x-text="paso"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <div x-show="addModalOpen" x-cloak class="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md">
        <div class="bg-white rounded-[2rem] shadow-2xl w-full max-w-md p-8 relative">
            <h3 class="text-2xl font-black mb-6 text-slate-800">Nueva Compra</h3>
            <div class="space-y-4">
                <input type="text" x-model="nuevoItem.nombre" placeholder="Nombre del alimento..." class="w-full p-4 border rounded-2xl bg-slate-50 outline-none focus:ring-2 focus:ring-custom-primary transition">
                <div class="flex gap-4">
                    <input type="number" x-model.number="nuevoItem.cantidad" placeholder="Cant." class="flex-1 p-4 border rounded-2xl bg-slate-50 outline-none">
                    <select x-model="nuevoItem.unidad" class="w-24 p-4 border rounded-2xl bg-slate-50 font-bold">
                        <option value="g">g</option>
                        <option value="und">und</option>
                        <option value="ml">ml</option>
                    </select>
                </div>
                <button @click="agregarItem()" class="w-full bg-custom-primary text-white font-black py-4 rounded-2xl shadow-xl hover:scale-[1.02] transition active:scale-95">
                    GUARDAR EN NEVERA
                </button>
                <button @click="addModalOpen = false" class="w-full text-slate-400 font-bold py-2 text-sm">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                sidebarOpen: false,
                buscando: false,
                modalOpen: false,
                addModalOpen: false,
                busqueda: '',
                recetaActiva: null,
                config: { adultos: 2, ninos: 1 },
                
                inventario: JSON.parse(localStorage.getItem('chefvzla_stock')) || [
                    { nombre: 'Harina de Ma√≠z', cantidad: 1000, unidad: 'g' },
                    { nombre: 'Huevo', cantidad: 6, unidad: 'und' }
                ],
                
                recetario: JSON.parse(localStorage.getItem('chefvzla_recipes')) || [
                    { 
                        nombre: 'Arepa de Huevo Cl√°sica', 
                        tipo: 'Desayuno', 
                        desc: 'La base de la alimentaci√≥n venezolana, pr√°ctica y vers√°til.',
                        ingredientes: { 'Harina de Ma√≠z': 100, 'Huevo': 1 },
                        preparacion: ['Vierte agua con sal en un bol.', 'Agrega harina y amasa hasta que est√© suave.', 'Haz discos y √°salos en sart√©n.', 'Abre y rellena con huevo revuelto.']
                    }
                ],

                // NUBE EXPANDIDA (Para que Lentejas y Pollo aparezcan)
                nubeRecetas: [
                    { 
                        nombre: 'Lentejas Guisadas al Estilo Criollo', 
                        tipo: 'Almuerzo', 
                        desc: 'Un plato cargado de hierro y sabor tradicional.',
                        ingredientes: { 'Lentejas': 100, 'Cebolla': 0.2, 'Papa': 0.5 },
                        preparacion: [
                            'Lava las lentejas y ponlas a hervir en abundante agua.',
                            'Mientras ablandan, pica la cebolla y la papa en cubos.',
                            'Sofr√≠e los vegetales y agr√©galos a las lentejas cuando est√©n tiernas.',
                            'Cocina a fuego bajo hasta que el caldo espese y rectifica la sal.'
                        ]
                    },
                    { 
                        nombre: 'Pollo Sudado con Papas', 
                        tipo: 'Almuerzo', 
                        desc: 'Jugoso, tierno y perfecto para acompa√±ar con arroz.',
                        ingredientes: { 'Pollo': 150, 'Papa': 1, 'Cebolla': 0.2 },
                        preparacion: [
                            'Corta el pollo en presas y sazona con sal.',
                            'En una olla, sella el pollo hasta que dore.',
                            'Agrega las papas y la cebolla con media taza de agua.',
                            'Tapa y deja cocinar al vapor por 20 minutos hasta que todo est√© tierno.'
                        ]
                    },
                    { 
                        nombre: 'Pescado Frito con Ensalada', 
                        tipo: 'Almuerzo', 
                        desc: 'Crujiente por fuera y jugoso por dentro.',
                        ingredientes: { 'Pescado': 200, 'Aceite': 50, 'Lim√≥n': 0.5 },
                        preparacion: [
                            'Limpia bien el pescado y hazle unos cortes laterales.',
                            'Sazona con sal y lim√≥n.',
                            'P√°salo por un poco de harina si deseas m√°s crocante.',
                            'Fr√≠e en aceite bien caliente hasta que dore por ambos lados.'
                        ]
                    }
                ],

                init() {
                    this.$watch('inventario', val => localStorage.setItem('chefvzla_stock', JSON.stringify(val)));
                    this.$watch('recetario', val => localStorage.setItem('chefvzla_recipes', JSON.stringify(val)));
                },

                get recetasAMostrar() {
                    const t = this.busqueda.toLowerCase();
                    if (t === '') {
                        return this.recetario.sort((a,b) => this.verificarStock(b) - this.verificarStock(a)).slice(0, 8);
                    }
                    return this.recetario.filter(r => 
                        r.nombre.toLowerCase().includes(t) || 
                        Object.keys(r.ingredientes).some(i => i.toLowerCase().includes(t))
                    );
                },

                async buscarEnInternet() {
                    this.buscando = true;
                    await new Promise(r => setTimeout(r, 1500));
                    
                    const t = this.busqueda.toLowerCase();
                    let encontradas = 0;

                    // Si no hay b√∫squeda, traemos todo lo de la nube
                    const fuente = t === '' ? this.nubeRecetas : this.nubeRecetas.filter(r => 
                        r.nombre.toLowerCase().includes(t) || 
                        Object.keys(r.ingredientes).some(i => i.toLowerCase().includes(t))
                    );

                    fuente.forEach(rn => {
                        if (!this.recetario.find(r => r.nombre === rn.nombre)) {
                            this.recetario.push(rn);
                            encontradas++;
                        }
                    });

                    this.buscando = false;
                    if(encontradas > 0) alert(`¬°Se han a√±adido ${encontradas} nuevas recetas de la nube!`);
                    else alert("No se encontraron nuevas recetas para esta b√∫squeda en la nube.");
                },

                // LOGICA DE NEGOCIO
                abrirReceta(r) { this.recetaActiva = r; this.modalOpen = true; },
                cerrarReceta() { this.modalOpen = false; this.recetaActiva = null; },
                calcularCantidad(base) { return Math.ceil(base * (this.config.adultos + (this.config.ninos * 0.5))); },
                obtenerUnidad(ing) {
                    const it = this.inventario.find(i => i.nombre.toLowerCase().includes(ing.toLowerCase()) || ing.toLowerCase().includes(i.nombre.toLowerCase()));
                    return it ? it.unidad : 'und.';
                },
                tieneIngrediente(nom, cant) {
                    const it = this.inventario.find(i => i.nombre.toLowerCase().includes(nom.toLowerCase()) || nom.toLowerCase().includes(i.nombre.toLowerCase()));
                    return it && it.cantidad >= cant;
                },
                verificarStock(receta) {
                    return Object.entries(receta.ingredientes).every(([ing, cant]) => this.tieneIngrediente(ing, this.calcularCantidad(cant)));
                },
                agregarItem() {
                    if(this.nuevoItem.nombre && this.nuevoItem.cantidad) {
                        const ex = this.inventario.find(i => i.nombre.toLowerCase() === this.nuevoItem.nombre.toLowerCase());
                        if(ex) ex.cantidad += this.nuevoItem.cantidad;
                        else this.inventario.push({...this.nuevoItem});
                        this.nuevoItem = { nombre: '', cantidad: null, unidad: 'g' };
                        this.addModalOpen = false;
                    }
                },
                eliminarItem(i) { this.inventario.splice(i, 1); },
                cocinar() {
                    if(!confirm("¬øConfirmas que preparaste esta receta? Se descontar√°n los ingredientes.")) return;
                    Object.entries(this.recetaActiva.ingredientes).forEach(([ing, cant]) => {
                        const it = this.inventario.find(i => i.nombre.toLowerCase().includes(ing.toLowerCase()) || ing.toLowerCase().includes(i.nombre.toLowerCase()));
                        if(it) it.cantidad = Math.max(0, it.cantidad - this.calcularCantidad(cant));
                    });
                    this.cerrarReceta();
                }
            }
        }
    </script>
</body>
</html>
