<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef VZLA - Inteligencia Culinaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* HOJA DE ESTILOS PERSONALIZADA */
        :root {
            --primary: #3D7A55;
            --dark: #14201D;
            --bg-light: #DDF6F1;
            --action: #66CFA0;
            --highlight: #fef08a;
        }

        [x-cloak] { display: none !important; }
        
        body { 
            background-color: var(--bg-light); 
            color: var(--dark);
            font-family: 'Inter', sans-serif;
        }

        .bg-custom-dark { background-color: var(--dark); }
        .bg-custom-primary { background-color: var(--primary); }
        .bg-custom-action { background-color: var(--action); }
        .text-custom-primary { color: var(--primary); }
        .border-custom-primary { border-color: var(--primary); }

        /* Scrollbar elegante */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-light); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        .recipe-card:hover {
            transform: translateY(-5px);
            border-color: var(--action);
            box-shadow: 0 10px 15px -3px rgba(61, 122, 85, 0.2);
        }

        .btn-main {
            background-color: var(--primary);
            color: white;
            transition: all 0.3s;
        }
        .btn-main:hover { background-color: var(--action); }
        
        .loading-shimmer {
            background: linear-gradient(90deg, #ddf6f1 25%, #66cfa0 50%, #ddf6f1 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden" x-data="app()">

    <nav class="bg-white border-b h-16 shrink-0 flex items-center justify-between px-6 shadow-sm z-30">
        <div class="flex items-center gap-3">
            <div class="bg-custom-primary text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-lg">
                <i class="fas fa-hat-chef fa-lg"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-none" style="color: var(--dark)">Chef<span class="text-custom-primary">VZLA</span></h1>
                <span class="text-[10px] text-slate-400 font-bold tracking-widest uppercase">Dashboard Inteligente</span>
            </div>
        </div>
        
        <div class="flex items-center bg-[#f8fafc] rounded-xl p-1.5 border border-slate-200">
            <div class="flex items-center px-4 border-r border-slate-300 gap-2">
                <div class="text-center">
                    <p class="text-[8px] font-bold uppercase opacity-50">Adultos</p>
                    <input type="number" x-model.number="config.adultos" class="w-8 bg-transparent text-center font-bold focus:outline-none">
                </div>
            </div>
            <div class="flex items-center px-4 gap-2">
                <div class="text-center">
                    <p class="text-[8px] font-bold uppercase opacity-50">Niños</p>
                    <input type="number" x-model.number="config.ninos" class="w-8 bg-transparent text-center font-bold focus:outline-none">
                </div>
            </div>
        </div>
    </nav>

    <div class="flex-1 flex overflow-hidden">
        
        <aside class="w-72 bg-white border-r flex flex-col hidden lg:flex">
            <div class="p-6 border-b" style="background-color: #fafdfc">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold flex items-center gap-2" style="color: var(--dark)">
                        <i class="fas fa-box-archive text-custom-primary"></i> Mi Despensa
                    </h2>
                    <button @click="addModalOpen = true" class="bg-custom-action text-white w-8 h-8 rounded-lg shadow-sm hover:scale-110 transition">
                        <i class="fas fa-plus text-xs"></i>
                    </button>
                </div>
                <div class="bg-white p-3 rounded-xl border border-dashed border-slate-200 text-center shadow-sm">
                    <p class="text-[10px] text-slate-400 font-bold uppercase mb-1">Items Disponibles</p>
                    <p class="text-2xl font-black text-custom-primary" x-text="inventario.length"></p>
                </div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 space-y-2">
                <template x-for="(item, index) in inventario" :key="index">
                    <div class="flex justify-between items-center p-3 rounded-xl border border-slate-100 bg-white hover:border-custom-primary transition group">
                        <div>
                            <p class="font-bold text-sm" style="color: var(--dark)" x-text="item.nombre"></p>
                            <p class="text-[10px] text-slate-400 font-medium" x-text="item.cantidad + ' ' + item.unidad"></p>
                        </div>
                        <button @click="eliminarItem(index)" class="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                            <i class="fas fa-trash-alt text-xs"></i>
                        </button>
                    </div>
                </template>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto p-4 md:p-8">
            
            <div class="max-w-5xl mx-auto mb-10">
                <div class="relative group">
                    <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-custom-primary transition"></i>
                    <input type="text" x-model="busqueda" placeholder="Escribe un ingrediente (ej. Atún, Pollo, Berenjena)..." 
                           class="w-full pl-14 pr-6 py-5 rounded-2xl bg-white shadow-md border-0 focus:ring-4 focus:ring-[#66CFA044] transition text-lg outline-none">
                </div>
            </div>

            <div class="max-w-5xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-extrabold flex items-center gap-2" style="color: var(--dark)">
                        <i class="fas fa-wand-magic-sparkles text-custom-primary"></i>
                        <span x-text="busqueda === '' ? 'Sugerencias para Hoy' : 'Resultados de Búsqueda'"></span>
                    </h2>
                    <button @click="buscarEnInternet()" 
                            class="text-xs font-bold px-5 py-2.5 rounded-full transition border border-custom-primary text-custom-primary hover:bg-custom-primary hover:text-white flex items-center gap-2">
                        <i class="fas fa-cloud-arrow-down" :class="buscando ? 'fa-spin' : ''"></i>
                        <span x-text="buscando ? 'Buscando...' : 'Explorar nuevas recetas'"></span>
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <template x-for="receta in recetasAMostrar" :key="receta.nombre">
                        <div @click="abrirReceta(receta)" 
                             class="recipe-card bg-white rounded-2xl border border-slate-100 overflow-hidden cursor-pointer transition-all duration-300 flex flex-col h-full">
                            
                            <div class="h-28 bg-slate-100 relative">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
                                <div class="absolute bottom-3 left-3">
                                    <span class="text-[9px] font-black text-white bg-custom-primary px-2 py-1 rounded-md uppercase tracking-wider" x-text="receta.tipo"></span>
                                </div>
                                <div class="absolute top-3 right-3">
                                    <div :class="verificarStock(receta) ? 'bg-green-500' : 'bg-highlight'" 
                                         class="w-3 h-3 rounded-full border-2 border-white shadow-sm"></div>
                                </div>
                            </div>

                            <div class="p-5 flex-1 flex flex-col">
                                <h3 class="font-bold text-sm mb-2 line-clamp-2" style="color: var(--dark)" x-text="receta.nombre"></h3>
                                <div class="mt-auto flex justify-between items-center pt-3 border-t border-slate-50">
                                    <span class="text-[10px] font-bold text-slate-400 tracking-tighter uppercase">
                                        <i class="far fa-clock mr-1"></i> <span x-text="receta.tiempo || '20 min'"></span>
                                    </span>
                                    <span class="text-[10px] font-bold" :class="verificarStock(receta) ? 'text-green-600' : 'text-orange-500'">
                                        <span x-text="verificarStock(receta) ? '¡TODO LISTO!' : 'FALTAN ITEMS'"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <div x-show="recetasAMostrar.length === 0" class="text-center py-20 bg-white/50 rounded-3xl border-2 border-dashed border-slate-300">
                    <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm">
                        <i class="fas fa-cloud-question text-3xl text-slate-300"></i>
                    </div>
                    <h3 class="font-bold text-slate-700 text-lg">No encontramos recetas locales</h3>
                    <p class="text-slate-400 text-sm mb-6 max-w-xs mx-auto">No tenemos recetas con "<span x-text="busqueda"></span>" en tu recetario local. ¿Quieres buscar en la nube?</p>
                    <button @click="buscarEnInternet()" class="bg-custom-dark text-white px-8 py-3 rounded-xl font-bold hover:bg-custom-primary transition flex items-center gap-2 mx-auto">
                        <i class="fas fa-search-plus"></i> Buscar en la Nube
                    </button>
                </div>
            </div>
        </main>
    </div>

    <div x-show="modalOpen" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div x-show="modalOpen" x-transition.opacity @click="cerrarReceta()" class="absolute inset-0 bg-[#14201Dcc] backdrop-blur-sm"></div>
        
        <div x-show="modalOpen" x-transition.scale.95 class="bg-white w-full max-w-5xl max-h-[90vh] rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row relative z-10">
            
            <button @click="cerrarReceta()" class="absolute top-5 right-5 bg-white p-2 rounded-full shadow-lg hover:text-red-500 transition z-30">
                <i class="fas fa-times text-lg"></i>
            </button>

            <template x-if="recetaActiva">
                <div class="contents">
                    <div class="md:w-80 p-8 border-r shrink-0 flex flex-col" style="background-color: #fafdfc">
                        <span class="text-xs font-black text-custom-primary uppercase tracking-widest mb-2" x-text="recetaActiva.tipo"></span>
                        <h2 class="text-2xl font-black mb-4 leading-tight" style="color: var(--dark)" x-text="recetaActiva.nombre"></h2>
                        <p class="text-sm text-slate-500 mb-8 leading-relaxed" x-text="recetaActiva.desc"></p>

                        <div class="bg-white p-4 rounded-2xl border border-slate-200 shadow-sm mb-6">
                            <p class="text-[10px] font-bold text-slate-400 uppercase mb-3">Ayuda Visual</p>
                            <a :href="'https://www.youtube.com/results?search_query=receta+venezolana+' + recetaActiva.nombre" target="_blank" 
                               class="flex items-center gap-3 text-red-600 hover:scale-105 transition font-bold text-xs">
                                <i class="fab fa-youtube text-2xl"></i> Ver video paso a paso
                            </a>
                        </div>

                        <div class="mt-auto pt-6">
                            <button @click="cocinar()" :disabled="!verificarStock(recetaActiva)"
                                    class="w-full py-4 rounded-2xl font-black text-white shadow-lg transition active:scale-95 disabled:bg-slate-200 disabled:text-slate-400 bg-custom-dark hover:bg-custom-primary">
                                <i class="fas fa-fire-burner mr-2"></i> COCINAR AHORA
                            </button>
                        </div>
                    </div>

                    <div class="flex-1 p-8 overflow-y-auto bg-white">
                        <div class="grid md:grid-cols-2 gap-10">
                            <div>
                                <h3 class="font-black text-lg mb-6 flex items-center gap-2" style="color: var(--dark)">
                                    <i class="fas fa-basket-shopping text-custom-primary"></i> Ingredientes
                                </h3>
                                <ul class="space-y-3">
                                    <template x-for="(cantBase, ing) in recetaActiva.ingredientes">
                                        <li class="flex justify-between items-center p-3 rounded-xl border border-transparent hover:bg-slate-50 hover:border-slate-100 transition">
                                            <div class="flex items-center gap-3">
                                                <div class="w-2 h-2 rounded-full" :class="tieneIngrediente(ing, calcularCantidad(cantBase)) ? 'bg-green-500' : 'bg-orange-400'"></div>
                                                <span class="text-sm font-medium" :class="tieneIngrediente(ing, calcularCantidad(cantBase)) ? 'text-slate-700' : 'text-orange-600 font-bold'" x-text="ing"></span>
                                            </div>
                                            <span class="text-[10px] font-black bg-slate-100 px-2 py-1 rounded-lg text-slate-500" x-text="calcularCantidad(cantBase) + ' ' + obtenerUnidad(ing)"></span>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <div>
                                <h3 class="font-black text-lg mb-6 flex items-center gap-2" style="color: var(--dark)">
                                    <i class="fas fa-list-check text-custom-primary"></i> Preparación
                                </h3>
                                <div class="space-y-6">
                                    <template x-for="(paso, idx) in recetaActiva.preparacion">
                                        <div class="flex gap-4">
                                            <div class="w-6 h-6 rounded-full bg-highlight text-custom-dark flex items-center justify-center font-black text-[10px] shrink-0 mt-1" x-text="idx + 1"></div>
                                            <p class="text-sm text-slate-600 leading-relaxed" x-text="paso"></p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <div x-show="addModalOpen" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-custom-dark/60 backdrop-blur-sm">
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md p-8">
            <h3 class="text-2xl font-black mb-6" style="color: var(--dark)">Nuevo Ingrediente</h3>
            <div class="space-y-4">
                <input type="text" x-model="nuevoItem.nombre" placeholder="Nombre (ej. Atún, Pasta...)" class="w-full p-4 border rounded-2xl bg-slate-50 outline-none focus:ring-2 focus:ring-custom-primary transition">
                <div class="flex gap-4">
                    <input type="number" x-model.number="nuevoItem.cantidad" placeholder="Cantidad" class="flex-1 p-4 border rounded-2xl bg-slate-50 outline-none">
                    <select x-model="nuevoItem.unidad" class="w-24 p-4 border rounded-2xl bg-slate-50 font-bold">
                        <option value="g">g</option>
                        <option value="und">und</option>
                        <option value="ml">ml</option>
                    </select>
                </div>
                <button @click="agregarItem()" class="w-full bg-custom-primary text-white font-black py-4 rounded-2xl shadow-xl hover:bg-custom-action transition transform active:scale-95">
                    AGREGAR A LA NEVERA
                </button>
                <button @click="addModalOpen = false" class="w-full text-slate-400 font-bold py-2 text-sm">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                buscando: false,
                modalOpen: false,
                addModalOpen: false,
                busqueda: '',
                recetaActiva: null,
                config: { adultos: 2, ninos: 1 },
                
                inventario: JSON.parse(localStorage.getItem('chefvzla_stock')) || [
                    { nombre: 'Harina de Maíz', cantidad: 1000, unidad: 'g' },
                    { nombre: 'Huevo', cantidad: 6, unidad: 'und' },
                    { nombre: 'Arroz', cantidad: 1500, unidad: 'g' }
                ],
                
                nuevoItem: { nombre: '', cantidad: null, unidad: 'g' },

                // RECETARIO LOCAL (Persistente)
                recetario: JSON.parse(localStorage.getItem('chefvzla_recipes')) || [
                    { 
                        nombre: 'Arepa con Perico', 
                        tipo: 'Desayuno', 
                        desc: 'El desayuno nacional por excelencia. Nutritivo y rendidor.',
                        ingredientes: { 'Harina de Maíz': 100, 'Huevo': 1, 'Cebolla': 0.1, 'Tomate': 0.2 },
                        preparacion: [
                            'Mezcla la harina con agua y sal hasta obtener una masa suave y sin grumos.',
                            'Forma las arepas y cocínalas en un budare o sartén hasta que estén doradas por ambos lados.',
                            'Para el perico: Sofríe cebolla y tomate picaditos en poco aceite.',
                            'Agrega los huevos batidos con sal y revuelve hasta que cuajen pero sigan jugosos.',
                            'Abre la arepa, coloca un toque de mantequilla y rellena generosamente.'
                        ]
                    }
                ],

                // BASE DE DATOS "EN LA NUBE" (Simulada para la búsqueda)
                nubeRecetas: [
                    { 
                        nombre: 'Pasta con Atún y Aliños', 
                        tipo: 'Almuerzo', 
                        desc: 'Una solución rápida para un almuerzo sabroso con ingredientes de despensa.',
                        ingredientes: { 'Pasta': 100, 'Atún': 50, 'Cebolla': 0.2, 'Tomate': 0.5 },
                        preparacion: [
                            'Cocina la pasta en abundante agua con sal hasta que esté al dente.',
                            'En una sartén, sofríe cebolla y tomate picados finamente hasta que se forme una salsa.',
                            'Escurre el atún y agrégalo al sofrito, rompiendo los trozos grandes con una cuchara.',
                            'Integra la pasta cocida con la salsa de atún y añade un poco de agua de la pasta si está muy seca.',
                            'Sirve caliente y, si tienes, añade un poco de queso rallado.'
                        ]
                    },
                    { 
                        nombre: 'Berenjenas Guisadas', 
                        tipo: 'Almuerzo/Cena', 
                        desc: 'Excelente opción vegetariana, económica y llena de sabor criollo.',
                        ingredientes: { 'Berenjena': 1, 'Cebolla': 0.2, 'Tomate': 0.5, 'Arroz': 100 },
                        preparacion: [
                            'Corta la berenjena en cubos y déjala en agua con sal por 10 min para quitar el amargor.',
                            'Prepara un arroz blanco sencillo como acompañamiento.',
                            'Sofríe cebolla y tomate. Agrega la berenjena escurrida.',
                            'Tapa y cocina a fuego bajo hasta que la berenjena esté muy tierna.',
                            'Sirve el guiso sobre el arroz caliente.'
                        ]
                    },
                    { 
                        nombre: 'Croquetas de Atún y Harina de Maíz', 
                        tipo: 'Cena/Merienda', 
                        desc: 'Una forma divertida de rendir el atún usando la harina de arepas.',
                        ingredientes: { 'Atún': 80, 'Harina de Maíz': 50, 'Cebolla': 0.1, 'Huevo': 1 },
                        preparacion: [
                            'En un bol, mezcla el atún escurrido, un huevo y cebolla muy picadita.',
                            'Añade harina de maíz poco a poco hasta que puedas formar bolitas que no se peguen.',
                            'Aplasta las bolitas para formar pequeñas hamburguesas.',
                            'Fríelas en muy poco aceite hasta que estén crujientes por fuera.',
                            'Acompáñalas con ensalada o solas con un toque de limón.'
                        ]
                    }
                ],

                init() {
                    this.$watch('inventario', val => localStorage.setItem('chefvzla_stock', JSON.stringify(val)));
                    this.$watch('recetario', val => localStorage.setItem('chefvzla_recipes', JSON.stringify(val)));
                },

                get recetasAMostrar() {
                    if (this.busqueda === '') {
                        // SUGERENCIA SIEMPRE ACTIVA: Prioriza las que puedes cocinar
                        const conStock = this.recetario.filter(r => this.verificarStock(r));
                        const sinStock = this.recetario.filter(r => !this.verificarStock(r));
                        return [...conStock, ...sinStock].slice(0, 8); // Muestra hasta 8 sugerencias
                    }
                    
                    const t = this.busqueda.toLowerCase();
                    return this.recetario.filter(r => 
                        r.nombre.toLowerCase().includes(t) || 
                        Object.keys(r.ingredientes).some(i => i.toLowerCase().includes(t))
                    );
                },

                async buscarEnInternet() {
                    this.buscando = true;
                    
                    // Simular retraso de red
                    await new Promise(r => setTimeout(r, 1200));

                    const t = this.busqueda.toLowerCase();
                    let encontradas = 0;

                    // Si no hay búsqueda, traemos cualquier cosa nueva de la nube
                    const fuente = t === '' ? this.nubeRecetas : this.nubeRecetas.filter(r => 
                        r.nombre.toLowerCase().includes(t) || 
                        Object.keys(r.ingredientes).some(i => i.toLowerCase().includes(t))
                    );

                    fuente.forEach(rn => {
                        const existe = this.recetario.find(r => r.nombre === rn.nombre);
                        if (!existe) {
                            this.recetario.push(rn);
                            encontradas++;
                        }
                    });

                    this.buscando = false;
                    
                    if (encontradas > 0) {
                        alert(`¡Conexión exitosa! He añadido ${encontradas} recetas nuevas a tu lista.`);
                    } else {
                        alert("No hay recetas nuevas en la nube para esta búsqueda.");
                    }
                },

                // LÓGICA TÉCNICA
                abrirReceta(r) { this.recetaActiva = r; this.modalOpen = true; },
                cerrarReceta() { this.modalOpen = false; this.recetaActiva = null; },

                calcularCantidad(base) {
                    return Math.ceil(base * (this.config.adultos + (this.config.ninos * 0.5)));
                },

                obtenerUnidad(ing) {
                    const it = this.inventario.find(i => i.nombre.toLowerCase().includes(ing.toLowerCase()) || ing.toLowerCase().includes(i.nombre.toLowerCase()));
                    return it ? it.unidad : 'und.';
                },

                tieneIngrediente(nom, cant) {
                    const it = this.inventario.find(i => i.nombre.toLowerCase().includes(nom.toLowerCase()) || nom.toLowerCase().includes(i.nombre.toLowerCase()));
                    return it && it.cantidad >= cant;
                },

                verificarStock(receta) {
                    return Object.entries(receta.ingredientes).every(([ing, cant]) => 
                        this.tieneIngrediente(ing, this.calcularCantidad(cant))
                    );
                },

                agregarItem() {
                    if(this.nuevoItem.nombre && this.nuevoItem.cantidad) {
                        const ex = this.inventario.find(i => i.nombre.toLowerCase() === this.nuevoItem.nombre.toLowerCase());
                        if(ex) ex.cantidad += this.nuevoItem.cantidad;
                        else this.inventario.push({...this.nuevoItem});
                        this.nuevoItem = { nombre: '', cantidad: null, unidad: 'g' };
                        this.addModalOpen = false;
                    }
                },

                eliminarItem(i) { this.inventario.splice(i, 1); },

                cocinar() {
                    if(!confirm("¿Descontar ingredientes del inventario?")) return;
                    Object.entries(this.recetaActiva.ingredientes).forEach(([ing, cant]) => {
                        const nec = this.calcularCantidad(cant);
                        const it = this.inventario.find(i => i.nombre.toLowerCase().includes(ing.toLowerCase()) || ing.toLowerCase().includes(i.nombre.toLowerCase()));
                        if(it) it.cantidad = Math.max(0, it.cantidad - nec);
                    });
                    this.cerrarReceta();
                }
            }
        }
    </script>
</body>
</html>
